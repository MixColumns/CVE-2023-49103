from shodan import Shodan
from shodan.helpers import iterate_files
import requests

from pprint import pprint
from sys import argv, exit

if len(argv) != 3:
    print('Usage: {} input.json output.txt ...'.format(argv[0]))
    exit(1)

ips = []
for banner in iterate_files(argv[1]):
    if "ip_str" in banner:
        ips.append(banner['ip_str'])
         with open(argv[2], "a") as f:
                f.write(url + "\n")



for ip in ips:
    url = f"http://{ip}/owncloud/apps/graphapi/vendor/microsoft/microsoft-graph/tests/GetPhpInfo.php"
    print("trying: " + url + "\n")
    try:
        code = requests.head(url, verify=False, allow_redirects=True).status_code
        print(str(ip) + " : " + str(code) + "\n")
        if code == 200:
            print("found: " + url + "\n")
            with open(argv[2], "a") as f:
                f.write(url + "\n")
    except requests.RequestException as e:
        print(str(ip) + " : " + str(e) + "\n")

    url = f"http://{ip}/apps/graphapi/vendor/microsoft/microsoft-graph/tests/GetPhpInfo.php"
    print("trying: " + url + "\n")
    try:
        code = requests.head(url, verify=False, allow_redirects=True).status_code
        print(str(ip) + " : " + str(code) + "\n")
        if code == 200:
            print("found: " + url + "\n")
            with open(argv[2], "a") as f:
                f.write(url + "\n")
    except requests.RequestException as e:
        print(str(ip) + " : " + str(e) + "\n")